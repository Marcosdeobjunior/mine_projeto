<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universo de Poderes</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a2e; --surface-color: #2a2a4e; --primary-color: #00ffff;
            --secondary-color: #ff00ff; --text-color: #e0e0ff; --text-muted: #8c8ca0;
            --border-color: #4a4a7f; --glow-color: rgba(0, 255, 255, 0.5);
            --font-display: 'Roboto Condensed', sans-serif; --font-mono: 'Share Tech Mono', monospace;
            --xp-color: #FFC107; --danger-color: #ff453a; --success-color: #00ff88;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-mono); background-color: var(--bg-color); color: var(--text-color); padding: 2rem; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 1400px; }
        .btn { font-family: var(--font-display); font-size: 1.1rem; text-transform: uppercase; padding: 0.7rem 1.2rem; border: 2px solid var(--primary-color); border-radius: 4px; background-color: transparent; color: var(--primary-color); cursor: pointer; transition: all 0.2s; box-shadow: 0 0 8px var(--glow-color); }
        .btn:hover { background-color: var(--primary-color); color: var(--bg-color); }
        .btn:disabled { border-color: var(--text-muted); color: var(--text-muted); box-shadow: none; cursor: not-allowed; }
        header { text-align: center; margin-bottom: 1.5rem; }
        header h1 { font-family: var(--font-display); font-size: 2.5rem; text-transform: uppercase; color: var(--primary-color); text-shadow: 0 0 10px var(--glow-color), 0 0 20px var(--secondary-color); }
        .main-controls { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 1rem; background-color: var(--surface-color); padding: 1rem; border-radius: 8px; margin-bottom: 2rem; border: 1px solid var(--border-color); }
        .control-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .control-group label { font-size: 0.8rem; text-align: center; color: var(--text-muted); }
        .control-group select { background-color: var(--bg-color); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 4px; padding: 0.5rem; font-family: var(--font-mono); }
        .battle-arena { display: grid; grid-template-columns: 1fr auto 1fr; gap: 2rem; align-items: flex-start; }
        .power-slot { background-color: var(--surface-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 1.5rem; min-height: 580px; display: flex; flex-direction: column; box-shadow: 0 0 15px rgba(0,0,0,0.5); transition: all 0.3s ease-in-out; }
        .power-card { display: none; flex-direction: column; gap: 1rem; flex-grow: 1; }
        .power-header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 2px solid var(--border-color); padding-bottom: 1rem; }
        .power-name { font-family: var(--font-display); font-size: 1.8rem; text-transform: uppercase; line-height: 1.2; margin-bottom: 0.5rem; }
        .power-level { font-size: 2.5rem; font-weight: bold; flex-shrink: 0; margin-left: 1rem; text-shadow: 0 0 5px var(--secondary-color); }
        .power-rarity { font-size: 1rem; font-weight: bold; padding: 5px 10px; border-radius: 4px; }
        .power-card h3 { font-family: var(--font-display); text-transform: uppercase; font-size: 1.2rem; color: var(--primary-color); border-bottom: 1px solid var(--border-color); padding-bottom: 5px; margin: 1rem 0 0.5rem 0; }
        .power-card ul { list-style: none; padding-left: 0; } .power-card ul li { margin-bottom: 0.5rem; line-height: 1.4; display: flex; flex-direction: column; gap: 0.1rem; }
        .power-card ul li.ultimate-ability { color: var(--xp-color); font-weight: bold; text-shadow: 0 0 5px var(--xp-color); }
        .power-actions { display: flex; gap: 1rem; margin-top: auto; }
        #battle-btn { border-color: var(--secondary-color); color: var(--secondary-color); box-shadow: 0 0 10px var(--secondary-color); }
        #battle-result { margin-top: 2rem; text-align: left; font-size: 1.1rem; font-family: var(--font-mono); min-height: 150px; line-height: 1.6; background-color: var(--surface-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 1.5rem; white-space: pre-wrap; }
        .rarity-comum { background-color: #9E9E9E; color: #111; } .rarity-incomum { background-color: #4CAF50; color: #fff; } .rarity-raro { background-color: #2196F3; color: #fff; } .rarity-epico { background-color: #9C27B0; color: #fff; } .rarity-lendario { background-color: #FFC107; color: #111; } .rarity-mitico { border: 2px solid #fff; background: linear-gradient(45deg, #ff00ff, #00ffff); color: #fff; }
        .rarity-transcendente { border: 2px solid #FFC107; background: linear-gradient(45deg, #f0f0ff, #c0c0ff); color: #000; }
        .rarity-divino { border: 2px solid #fff; background: radial-gradient(circle, #fff, #FFD700, #ff00ff, #00ffff); color: #000; animation: divino-glow 3s ease-in-out infinite alternate; }
        @keyframes divino-glow { from { box-shadow: 0 0 10px #fff, 0 0 20px #FFD700; } to { box-shadow: 0 0 20px #00ffff, 0 0 30px #ff00ff; } }
        
        .domain-fogo { border-color: #ff6a00; background: radial-gradient(circle, var(--surface-color) 70%, #ff480033); }
        .domain-agua { border-color: #00aaff; background: radial-gradient(circle, var(--surface-color) 70%, #00aaff33); }
        .domain-natureza { border-color: #00ff88; background: radial-gradient(circle, var(--surface-color) 70%, #00ff8833); }
        @keyframes battle-clash { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        @keyframes winner-glow { 0%, 100% { box-shadow: 0 0 25px var(--xp-color); } 50% { box-shadow: 0 0 10px var(--xp-color); } }
        @keyframes loser-fade { to { opacity: 0.6; transform: scale(0.98); } }
        .battle-clash { animation: battle-clash 0.5s ease-in-out; }
        .winner-glow { animation: winner-glow 1.5s ease-in-out infinite; }
        .loser-fade { animation: loser-fade 0.5s forwards; }
        
        /* Outros estilos permanecem... */

        @media (max-width: 900px) { body { padding: 1rem; } .battle-arena { grid-template-columns: 1fr; } }

        /* --- ESTILOS PARA BATALHA EM TURNOS --- */
        .power-stats { margin: 1rem 0; display: flex; flex-direction: column; gap: 0.5rem; }
        .stat-bar { display: flex; align-items: center; gap: 0.5rem; }
        .stat-bar-label { font-size: 0.8rem; width: 30px; }
        .bar-background { flex-grow: 1; height: 12px; background-color: #111; border-radius: 6px; overflow: hidden; border: 1px solid var(--border-color); }
        .bar-fill { height: 100%; transition: width 0.3s ease-in-out; }
        .hp-bar .bar-fill { background-color: var(--success-color); }
        .mp-bar .bar-fill { background-color: var(--primary-color); }
        .stat-bar-value { font-size: 0.8rem; min-width: 60px; text-align: right; }
        .stat-row { text-align: center; font-size: 0.9rem; margin-top: 0.5rem; }
        
        .abilities-list.in-battle li {
            cursor: pointer;
            background-color: var(--bg-color);
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }
        .abilities-list.in-battle li:hover {
            background-color: var(--border-color);
            border-color: var(--primary-color);
        }
        .abilities-list li.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background-color: transparent !important;
            border-color: var(--border-color) !important;
        }
        .power-slot.current-turn {
             box-shadow: 0 0 25px var(--xp-color);
             transform: scale(1.02);
        }
        .battle-result {
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <header><h1>Universo de Poderes</h1></header>
        <div class="main-controls">
            <div class="control-group"><label for="rarity-filter">Filtrar Raridade</label><select id="rarity-filter"><option value="any">Qualquer</option></select></div>
            <div class="control-group"><label for="domain-filter">Filtrar Dom√≠nio</label><select id="domain-filter"><option value="any">Qualquer</option></select></div>
            <button class="btn" id="generate-filtered-btn">Gerar para A</button>
            </div>
        
        <div class="battle-arena">
            <div class="power-slot" id="power-a">
                <div class="power-card">
                    <div class="power-header">
                        <div>
                            <div class="power-name"></div>
                            <div class="power-type-tag"></div>
                            <div class="power-rarity"></div>
                        </div>
                        <div class="power-level"></div>
                    </div>
                    
                    <div class="power-stats">
                        <div class="stat-bar hp-bar">
                            <div class="stat-bar-label">HP</div>
                            <div class="bar-background"><div class="bar-fill"></div></div>
                            <div class="stat-bar-value"></div>
                        </div>
                        <div class="stat-bar mp-bar">
                            <div class="stat-bar-label">MP</div>
                            <div class="bar-background"><div class="bar-fill"></div></div>
                            <div class="stat-bar-value"></div>
                        </div>
                        <div class="stat-row">
                            <span class="attack-value"></span> | <span class="defense-value"></span>
                        </div>
                    </div>

                    <p class="power-description"></p>
                    <div><h3>Habilidades</h3><ul class="abilities-list"></ul></div>
                    <div><h3>Fraquezas</h3><ul class="weaknesses-list"></ul></div>
                </div>
                <div class="power-actions">
                    <button class="btn" data-action="save-power" data-slot="a" style="display:none;">Salvar</button>
                    <button class="btn" data-action="share-power" data-slot="a" style="display:none;">Compartilhar</button>
                    <button class="btn generate-btn" data-slot="a">Gerar Aleat√≥rio</button>
                </div>
            </div>

            <div class="battle-controls"><button class="btn" id="battle-btn" disabled>Batalhar!</button></div>

            <div class="power-slot" id="power-b">
                <div class="power-card">
                    <div class="power-header">
                        <div>
                            <div class="power-name"></div>
                            <div class="power-type-tag"></div>
                            <div class="power-rarity"></div>
                        </div>
                        <div class="power-level"></div>
                    </div>
                    
                    <div class="power-stats">
                        <div class="stat-bar hp-bar">
                            <div class="stat-bar-label">HP</div>
                            <div class="bar-background"><div class="bar-fill"></div></div>
                            <div class="stat-bar-value"></div>
                        </div>
                        <div class="stat-bar mp-bar">
                            <div class="stat-bar-label">MP</div>
                            <div class="bar-background"><div class="bar-fill"></div></div>
                            <div class="stat-bar-value"></div>
                        </div>
                        <div class="stat-row">
                            <span class="attack-value"></span> | <span class="defense-value"></span>
                        </div>
                    </div>
                    
                    <p class="power-description"></p>
                    <div><h3>Habilidades</h3><ul class="abilities-list"></ul></div>
                    <div><h3>Fraquezas</h3><ul class="weaknesses-list"></ul></div>
                </div>
                <div class="power-actions">
                    <button class="btn" data-action="save-power" data-slot="b" style="display:none;">Salvar</button>
                    <button class="btn" data-action="share-power" data-slot="b" style="display:none;">Compartilhar</button>
                    <button class="btn generate-btn" data-slot="b">Gerar Aleat√≥rio</button>
                </div>
            </div>
        </div>
        <div class="battle-result" id="battle-result"></div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- BANCO DE DADOS ATUALIZADO ---
        // Habilidades agora s√£o objetos com atributos
        const rarities = { comum: { name: 'Comum', score: 1, weight: 40 }, incomum: { name: 'Incomum', score: 2, weight: 30 }, raro: { name: 'Raro', score: 4, weight: 15 }, epico: { name: '√âpico', score: 8, weight: 9 }, lendario: { name: 'Lend√°rio', score: 16, weight: 4 }, mitico: { name: 'M√≠tico', score: 32, weight: 1.5 }, transcendente: { name: 'Transcendente', score: 50, weight: 0.4 }, divino: { name: 'Divino', score: 100, weight: 0.1 } };
        const levels = { E: { name: 'E', score: 1 }, D: { name: 'D', score: 2 }, C: { name: 'C', score: 4 }, B: { name: 'B', score: 8 }, A: { name: 'A', score: 16 }, S: { name: 'S', score: 32 }, 'S+': { name: 'S+', score: 48 }, SS: { name: 'SS', score: 64 }, 'SS+': { name: 'SS+', score: 96 }, SSS: { name: 'SSS', score: 128 }, 'SSS+': { name: 'SSS+', score: 192 }, UR: { name: 'UR', score: 256 }, 'UR+': { name: 'UR+', score: 384 }, EX: { name: 'EX', score: 512 } };
        const domains = {
            fogo: { 
                name: 'Fogo', advantage: 'natureza',
                stats: { atk: 1.2, def: 0.8, hp: 1.0, mp: 1.0 },
                abilities: [
                    { name: 'Bola de Fogo', damage: 20, cost: 10, type: 'attack', desc: 'Um proj√©til flamejante.' },
                    { name: 'Manto de Fogo', damage: 0, cost: 15, type: 'buff_def', value: 5, desc: 'Aumenta a defesa por um tempo.' },
                    { name: 'Rajada de Cinzas', damage: 10, cost: 8, type: 'attack', desc: 'Ataque r√°pido de baixo custo.' },
                    { name: 'Supernova', damage: 100, cost: 80, type: 'ultimate', desc: 'Explos√£o devastadora.' }
                ],
                weaknesses: ['Vulner√°vel √† √°gua e frio extremo', 'Requer oxig√™nio para combust√£o']
            },
            agua: {
                name: '√Ågua', advantage: 'fogo',
                stats: { atk: 1.0, def: 1.0, hp: 1.1, mp: 1.1 },
                abilities: [
                    { name: 'Jato d\'√Ågua', damage: 18, cost: 10, type: 'attack', desc: 'Um jato de √°gua pressurizada.' },
                    { name: 'B√™n√ß√£o da Mar√©', damage: 0, cost: 20, type: 'heal', value: 40, desc: 'Recupera uma por√ß√£o de HP.' },
                    { name: 'Pris√£o Aqu√°tica', damage: 5, cost: 15, type: 'debuff_atk', value: -5, desc: 'Prende e reduz o ataque do alvo.' },
                    { name: 'Tsunami', damage: 85, cost: 70, type: 'ultimate', desc: 'Onda massiva que atinge o inimigo.' }
                ],
                weaknesses: ['Vulner√°vel √† eletricidade', 'Poder reduzido em desertos']
            },
            natureza: {
                name: 'Natureza', advantage: 'gelo',
                stats: { atk: 0.9, def: 1.2, hp: 1.2, mp: 0.9 },
                abilities: [
                    { name: 'Chicote de Cip√≥', damage: 15, cost: 9, type: 'attack', desc: 'Ataque r√°pido com cip√≥s.' },
                    { name: 'Toque Regenerativo', damage: 0, cost: 25, type: 'heal', value: 50, desc: 'Cura profunda.' },
                    { name: 'Muralha de Espinhos', damage: 0, cost: 18, type: 'buff_def', value: 8, desc: 'Aumenta muito a defesa.' },
                    { name: 'F√∫ria da Floresta', damage: 70, cost: 60, type: 'ultimate', desc: 'A natureza ataca com for√ßa total.' }
                ],
                weaknesses: ['Vulner√°vel ao fogo', 'Fraco em ambientes urbanos']
            },
            // Adicione mais dom√≠nios atualizados aqui...
        };
        
        // --- VARI√ÅVEIS DE ESTADO DA APLICA√á√ÉO ---
        let powerA = null;
        let powerB = null;
        let isBattleActive = false;
        let currentTurn = 'a';
        let battleLog = [];
        
        const battleBtn = document.getElementById('battle-btn');
        const resultEl = document.getElementById('battle-result');
        
        // --- FUN√á√ïES PRINCIPAIS ATUALIZADAS ---
        
        function generatePower(options = {}) {
            const rarityKey = options.rarity && options.rarity !== 'any' ? options.rarity : weightedRandom(rarities);
            const domainKey = options.domain && options.domain !== 'any' ? options.domain : getRandomKey(domains);
            const rarity = rarities[rarityKey];
            const domain = domains[domainKey];
            const levelKey = Object.keys(levels)[Math.floor(Math.random() * Object.keys(levels).length)];
            const level = levels[levelKey];

            // C√°lculo dos novos atributos
            const baseHp = 100;
            const baseMp = 50;
            const baseAtk = 10;
            const baseDef = 10;
            
            const maxHp = Math.floor((baseHp + rarity.score * 10 + level.score * 5) * domain.stats.hp);
            const maxMp = Math.floor((baseMp + rarity.score * 5 + level.score * 2) * domain.stats.mp);
            const attack = Math.floor((baseAtk + rarity.score * 2 + level.score) * domain.stats.atk);
            const defense = Math.floor((baseDef + rarity.score * 2 + level.score) * domain.stats.def);
            
            const powerName = `${domain.name} ${level.name}`;
            const description = `Um poder do dom√≠nio ${domain.name}.`;
            const finalAbilities = getRandomSample(domain.abilities, 3);

            return {
                uid: Date.now() + Math.random(),
                name: powerName, rarityKey, rarity, levelKey, level, domainKey, domain, description,
                abilities: finalAbilities, weaknesses: domain.weaknesses,
                // Novos atributos
                hp: maxHp, maxHp, mp: maxMp, maxMp, attack, defense,
                // Buffs/Debuffs tempor√°rios para a batalha
                tempAtk: 0, tempDef: 0
            };
        }

        function renderPower(power, slot) {
            const slotEl = document.getElementById(`power-${slot}`);
            if (!slotEl) return;
            slotEl.className = `power-slot domain-${power.domainKey}`;
            const cardEl = slotEl.querySelector('.power-card');
            
            // Info b√°sica
            cardEl.querySelector('.power-name').textContent = power.name;
            cardEl.querySelector('.power-rarity').textContent = power.rarity.name;
            cardEl.querySelector('.power-rarity').className = `power-rarity rarity-${power.rarityKey}`;
            cardEl.querySelector('.power-level').textContent = power.level.name;
            cardEl.querySelector('.power-description').textContent = power.description;

            // Renderiza os novos stats
            updateStatsUI(power, slot);

            // Renderiza habilidades como bot√µes
            const abilitiesListEl = cardEl.querySelector('.abilities-list');
            abilitiesListEl.innerHTML = power.abilities.map((ab, index) => `
                <li data-slot="${slot}" data-ability-index="${index}">
                    <strong>${ab.name}</strong> (MP: ${ab.cost})<br>
                    <small>${ab.desc}</small>
                </li>
            `).join('');

            cardEl.querySelector('.weaknesses-list').innerHTML = power.weaknesses.map(wk => `<li>- ${wk}</li>`).join('');
            cardEl.style.display = 'flex';
        }

        function updateStatsUI(power, slot) {
            const slotEl = document.getElementById(`power-${slot}`);
            
            const hpPercent = (power.hp / power.maxHp) * 100;
            slotEl.querySelector('.hp-bar .bar-fill').style.width = `${hpPercent}%`;
            slotEl.querySelector('.hp-bar .stat-bar-value').textContent = `${power.hp}/${power.maxHp}`;
            
            const mpPercent = (power.mp / power.maxMp) * 100;
            slotEl.querySelector('.mp-bar .bar-fill').style.width = `${mpPercent}%`;
            slotEl.querySelector('.mp-bar .stat-bar-value').textContent = `${power.mp}/${power.maxMp}`;

            slotEl.querySelector('.attack-value').textContent = `ATK: ${power.attack + power.tempAtk}`;
            slotEl.querySelector('.defense-value').textContent = `DEF: ${power.defense + power.tempDef}`;
        }


        // --- NOVA L√ìGICA DE BATALHA ---

        function startBattle() {
            if (!powerA || !powerB) return;
            isBattleActive = true;
            battleLog = ['A batalha come√ßou!'];
            
            // Reseta HP/MP e buffs para o in√≠cio da batalha
            powerA.hp = powerA.maxHp; powerA.mp = powerA.maxMp; powerA.tempAtk = 0; powerA.tempDef = 0;
            powerB.hp = powerB.maxHp; powerB.mp = powerB.maxMp; powerB.tempAtk = 0; powerB.tempDef = 0;
            
            renderPower(powerA, 'a');
            renderPower(powerB, 'b');

            currentTurn = 'a'; // Poder A sempre come√ßa
            updateBattleUI();
            
            battleBtn.textContent = "Batalha em Andamento";
            battleBtn.disabled = true;
        }

        function takeTurn(slot, abilityIndex) {
            if (!isBattleActive || slot !== currentTurn) return;

            const attacker = (slot === 'a') ? powerA : powerB;
            const defender = (slot === 'a') ? powerB : powerA;
            const defenderSlot = (slot === 'a') ? 'b' : 'a';
            const ability = attacker.abilities[abilityIndex];

            if (attacker.mp < ability.cost) {
                addToLog(`Turno de ${attacker.name}: Falta MP para usar ${ability.name}!`);
                updateBattleUI();
                return;
            }
            attacker.mp -= ability.cost;

            let logMessage = `Turno de ${attacker.name}: usou ${ability.name}!`;

            // L√≥gica dos tipos de habilidade
            switch(ability.type) {
                case 'attack':
                    const totalAttack = attacker.attack + attacker.tempAtk + ability.damage;
                    const totalDefense = defender.defense + defender.tempDef;
                    let damageDealt = Math.max(1, totalAttack - totalDefense); // Garante pelo menos 1 de dano
                    // Vantagem de dom√≠nio aumenta o dano
                    if (attacker.domain.advantage === defender.domainKey) {
                        damageDealt = Math.floor(damageDealt * 1.5);
                        logMessage += ` √â super efetivo!`;
                    }
                    defender.hp = Math.max(0, defender.hp - damageDealt);
                    logMessage += ` ${defender.name} sofreu ${damageDealt} de dano.`;
                    break;
                case 'heal':
                    attacker.hp = Math.min(attacker.maxHp, attacker.hp + ability.value);
                    logMessage += ` ${attacker.name} recuperou ${ability.value} de HP.`;
                    break;
                case 'buff_def':
                    attacker.tempDef += ability.value;
                    logMessage += ` A defesa de ${attacker.name} aumentou!`;
                    break;
                // Adicione mais tipos de habilidade aqui (buff_atk, debuff, etc.)
            }
            addToLog(logMessage);
            updateBattleUI();

            // Checa se a batalha terminou
            if (defender.hp <= 0) {
                endBattle(attacker, defender);
                return;
            }

            // Passa o turno
            currentTurn = defenderSlot;
            updateBattleUI();
            
            // Se for o turno do computador (B), aciona a IA
            if (currentTurn === 'b') {
                setTimeout(aiTurn, 1000); // D√° um segundo para o jogador ler o log
            }
        }
        
        function aiTurn() {
            if (!isBattleActive) return;
            // IA Simples: escolhe uma habilidade aleat√≥ria que pode usar
            const usableAbilities = powerB.abilities.map((ab, index) => ({...ab, index}))
                                                   .filter(ab => powerB.mp >= ab.cost);
            
            if (usableAbilities.length > 0) {
                const choice = usableAbilities[Math.floor(Math.random() * usableAbilities.length)];
                takeTurn('b', choice.index);
            } else {
                addToLog(`${powerB.name} est√° sem MP para atacar!`);
                currentTurn = 'a'; // Passa o turno de volta
                updateBattleUI();
            }
        }
        
        function endBattle(winner, loser) {
            isBattleActive = false;
            addToLog(`A batalha terminou! ${winner.name} √© o vencedor!`);
            document.getElementById(`power-${winner === powerA ? 'a' : 'b'}`).classList.add('winner-glow');
            document.getElementById(`power-${loser === powerA ? 'a' : 'b'}`).classList.add('loser-fade');
            
            battleBtn.textContent = "Batalhar!";
            battleBtn.disabled = !(powerA && powerB);
        }

        function addToLog(message) {
            battleLog.unshift(message); // Adiciona no in√≠cio
            if (battleLog.length > 10) battleLog.pop(); // Mant√©m o log curto
            resultEl.innerHTML = battleLog.join('<br>');
        }
        
        function updateBattleUI() {
            updateStatsUI(powerA, 'a');
            updateStatsUI(powerB, 'b');

            // Habilita/desabilita as listas de habilidades
            const listA = document.querySelector('#power-a .abilities-list');
            const listB = document.querySelector('#power-b .abilities-list');
            
            if (isBattleActive) {
                listA.classList.add('in-battle');
                listB.classList.add('in-battle');
                document.getElementById('power-a').classList.toggle('current-turn', currentTurn === 'a');
                document.getElementById('power-b').classList.toggle('current-turn', currentTurn === 'b');
                
                // Desabilita habilidades que n√£o podem ser usadas (falta de MP)
                powerA.abilities.forEach((ab, index) => {
                    const li = listA.querySelector(`li[data-ability-index="${index}"]`);
                    li.classList.toggle('disabled', powerA.mp < ab.cost || currentTurn !== 'a');
                });
                powerB.abilities.forEach((ab, index) => {
                    const li = listB.querySelector(`li[data-ability-index="${index}"]`);
                    li.classList.toggle('disabled', true); // IA joga sozinha, ent√£o sempre desabilitado para clique
                });
            } else {
                listA.classList.remove('in-battle');
                listB.classList.remove('in-battle');
                document.getElementById('power-a').classList.remove('current-turn', 'winner-glow', 'loser-fade');
                document.getElementById('power-b').classList.remove('current-turn', 'winner-glow', 'loser-fade');
            }
        }

        function generateAndRender(slot) {
            const newPower = generatePower();
            if (slot === 'a') powerA = newPower; else powerB = newPower;
            renderPower(newPower, slot);
            resultEl.innerHTML = '';
            battleBtn.disabled = !(powerA && powerB);
            battleBtn.textContent = "Batalhar!";
            updateBattleUI(); // reseta classes de batalha
        }
        
        // --- EVENT LISTENERS ---
        
        document.querySelectorAll('.generate-btn').forEach(btn => btn.addEventListener('click', () => generateAndRender(btn.dataset.slot)));
        battleBtn.addEventListener('click', startBattle);

        // Listener para cliques nas habilidades
        document.querySelector('.battle-arena').addEventListener('click', (e) => {
            const abilityLi = e.target.closest('.abilities-list.in-battle li:not(.disabled)');
            if (abilityLi) {
                const slot = abilityLi.dataset.slot;
                const abilityIndex = parseInt(abilityLi.dataset.abilityIndex);
                takeTurn(slot, abilityIndex);
            }
        });
        
        // Fun√ß√µes auxiliares (sem grandes mudan√ßas)
        const weightedRandom = (items) => { const total = Object.values(items).reduce((s, i) => s + i.weight, 0); let r = Math.random() * total; for (const k in items) { if (r < items[k].weight) return k; r -= items[k].weight; } };
        const getRandomKey = (obj) => { const keys = Object.keys(obj); return keys[Math.floor(Math.random() * keys.length)]; };
        const getRandomSample = (arr, n) => [...arr].sort(() => 0.5 - Math.random()).slice(0, n);

        // Inicializa√ß√£o
        function initialize() { 
            // Adicionar c√≥digo de popular filtros aqui se necess√°rio
        }
        initialize();
    });
    </script>
</body>
</html>
